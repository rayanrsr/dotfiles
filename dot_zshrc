# Enable Powerlevel10k instant prompt. Should stay close to the top of ~/.zshrc.
# Initialization code that may require console input (password prompts, [y/n]
# confirmations, etc.) must go above this block; everything else may go below.
if [[ -r "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh" ]]; then
  source "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh"
fi

# Basic zsh configuration
export LANG=en_US.UTF-8
export EDITOR='nvim'
source ~/powerlevel10k/powerlevel10k.zsh-theme
export PATH="$HOME/.local/bin:$PATH"

# History settings
HISTFILE=~/.zsh_history
HISTSIZE=10000
SAVEHIST=10000
setopt SHARE_HISTORY
setopt HIST_IGNORE_DUPS
setopt HIST_IGNORE_ALL_DUPS
setopt HIST_FIND_NO_DUPS
setopt HIST_SAVE_NO_DUPS
setopt HIST_REDUCE_BLANKS
setopt HIST_VERIFY
setopt EXTENDED_HISTORY

# Completion settings
autoload -Uz compinit
compinit

# Enable case-insensitive completion
zstyle ':completion:*' matcher-list 'm:{a-z}={A-Za-z}'
zstyle ':completion:*' menu select
zstyle ':completion:*' list-colors "${(s.:.)LS_COLORS}"


[ -f ~/.fzf.zsh ] && source ~/.fzf.zsh


alias oldvim="\vim"
alias vim="nvim"
alias vimdiff="nvim -d"
alias vi="nvim"
alias v="nvim"
alias oldvi="\vi"

alias zshconfig="nvim ~/.zshrc"
alias ohmyzsh="nvim ~/.oh-my-zsh"
alias yz="yazi"

# Git stuff
alias ga='git add'
alias gap='ga --patch'
alias gb='git branch'
alias gba='gb --all'
alias gc='git commit'
alias gca='gc --amend --no-edit'
alias gce='gc --amend'
alias gco='git checkout'
alias gcl='git clone --recursive'
alias gd='git diff --output-indicator-new=" " --output-indicator-old=" "'
alias gds='gd --staged'
alias gi='git init'
alias gl='git log --graph --all --pretty=format:"%C(magenta)%h %C(white) %an  %ar%C(auto)  %D%n%s%n"'
alias gm='git merge'
alias gn='git checkout -b'  # new branch
alias gp='git push'
alias gr='git reset'
alias gs='git status --short'
alias gu='git pull'

# Aliases: docker
alias dps='docker ps --format "table {{.Names}}\t{{.Status}}\t{{.Ports}}"'
alias dl='docker logs --tail=100'
alias dc='docker compose'

# Aliases: tmux
alias ta='tmux attach'
alias tl='tmux list-sessions'
alias tn='tmux new-session -s'

# Aliases: chezmoi
alias cz='chezmoi'
alias cza='chezmoi apply'
alias czd='chezmoi diff'
alias czl='chezmoi ls'
alias czp='chezmoi preview'
alias czr='chezmoi resolve'
alias czs='chezmoi status'
alias czc='chezmoi cd'

# LazyGit and LazyDocker
alias lg='lazygit'
alias ld='lazydocker'



alias open='xdg-open 2>/dev/null'
alias please='sudo !!'
alias aid='aider --vim --model gemini --read ~/ai_rules'

# add bpytop as an alias for both top and htop
alias top="bpytop"
alias htop="bpytop"
# ls after every cd command
# Custom cd function to automatically list directory contents
cd() {
    builtin cd "$@" && ls
}

# add bat as an alias for cat
# if bat command is detected alias it to cat, otherwise alias batcat
if command -v bat &> /dev/null
then
    alias cat="bat"
else
    alias batcat="batcat"
fi

# add lsd as an alias for ls
alias ls="lsd"

# Note taking
notes() {
  if tmux has-session -t Notes 2>/dev/null; then
    if [ -n "$TMUX" ]; then
      tmux switch-client -t Notes
    else
      tmux attach-session -t Notes
    fi
  else
    tmux new-session -ds Notes -c ~/Documents/Notes 'nvim .'
  fi
  if [ -n "$TMUX" ]; then
    tmux switch-client -t Notes
  else
    tmux attach-session -t Notes
  fi
}
bindkey -s ^n 'notes\n'

bindkey -s ^e 'selected_entry=$(find $HOME/Downloads $HOME/Documents -maxdepth 8 -type f -o -type d | fzf --preview "bat --style=numbers --color=always --line-range=:500 {}" --preview-window=right:60%); [ -n "$selected_entry" ] && { [ -d "$selected_entry" ] && cd "$selected_entry" || vim "$selected_entry"; }\n'
# now Ctrl + e will execute ~/scripts/tmux_sessionizer.sh
bindkey -s ^f 'tmux-sessionizer\n'


# FZF THEME
export FZF_DEFAULT_OPTS=" \
--color=bg+:#313244,bg:#1e1e2e,spinner:#f5e0dc,hl:#f38ba8 \
--color=fg:#cdd6f4,header:#f38ba8,info:#cba6f7,pointer:#f5e0dc \
--color=marker:#f5e0dc,fg+:#cdd6f4,prompt:#cba6f7,hl+:#f38ba8"

# FZF-TAB configuration (if available)
if [[ -f ~/.fzf-tab/fzf-tab.plugin.zsh ]]; then
    source ~/.fzf-tab/fzf-tab.plugin.zsh
    zstyle ':fzf-tab:complete:cd:*' fzf-preview 'eza -1 --color=always $realpath'
fi


PATH="$HOME/perl5/bin${PATH:+:${PATH}}"; export PATH;
PERL5LIB="$HOME/perl5/lib/perl5${PERL5LIB:+:${PERL5LIB}}"; export PERL5LIB;
PERL_LOCAL_LIB_ROOT="$HOME/perl5${PERL_LOCAL_LIB_ROOT:+:${PERL_LOCAL_LIB_ROOT}}"; export PERL_LOCAL_LIB_ROOT;
PERL_MB_OPT="--install_base \"$HOME/perl5\""; export PERL_MB_OPT;
PERL_MM_OPT="INSTALL_BASE=$HOME/perl5"; export PERL_MM_OPT;


# Export google-cloud-sdk
export PATH="$HOME/google-cloud-sdk/bin:$PATH"

export PATH=$PATH:~/miniconda3/bin
export PATH=$PATH:~/.local/bin


# bun
export BUN_INSTALL="$HOME/.bun"
export PATH="$BUN_INSTALL/bin:$PATH"



export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"  # This loads nvm
[ -s "$NVM_DIR/bash_completion" ] && \. "$NVM_DIR/bash_completion"  # This loads nvm bash_completion


eval "$(uv generate-shell-completion zsh)"
eval "$(uvx --generate-shell-completion zsh)"

_uv_run_mod() {
    if [[ "$words[2]" == "run" && "$words[CURRENT]" != -* ]]; then
        _arguments '*:filename:_files'
    else
        uv "$@"
    fi
}
compdef _uv_run_mod uv

export DOCKER_BUILDKIT=1

if [ -f ~/.env_exports ]; then
  source ~/.env_exports
else
  echo "File ~/.env_exports not found."
fi


autoload -Uz bashcompinit && bashcompinit

# Load standalone plugins (install these separately)
# zsh-autosuggestions
[[ -f ~/.zsh-autosuggestions/zsh-autosuggestions.zsh ]] && source ~/.zsh-autosuggestions/zsh-autosuggestions.zsh

# zsh-syntax-highlighting
[[ -f ~/.zsh-syntax-highlighting/zsh-syntax-highlighting.zsh ]] && source ~/.zsh-syntax-highlighting/zsh-syntax-highlighting.zsh

# z (jump around)
[[ -f ~/.z.sh ]] && source ~/.z.sh

# To customize prompt, run `p10k configure` or edit ~/.p10k.zsh.
[[ ! -f ~/.p10k.zsh ]] || source ~/.p10k.zsh
